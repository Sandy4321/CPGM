<!DOCTYPE HTML>
<html>
<head>
<title>Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="css/style.css" rel="stylesheet" type="text/css" media="all" />
<link rel="stylesheet" type="text/css" href="css/master.css">
<link rel="stylesheet" type="text/css" href="css/checkout.css">
<style type="text/css">
	#pay{
		font-family: 'Exo 2', sans-serif;
		cursor: pointer;
		color: #FFF;
		font-size: 1em;
		outline: none;
		-webkit-transition: all 0.3s;
		-moz-transition: all 0.3s;
		transition: all 0.3s;
		background: #7EB123;
		padding: 12px 20px;
		border: none;
		margin-top: 20px;
		-webkit-appearance: none;
	}
</style>

<script type="text/javascript" src="js/jquery1.min.js"></script>
<!-- start menu -->
<link href="css/megamenu.css" rel="stylesheet" type="text/css" media="all" />
<script type="text/javascript" src="js/megamenu.js"></script>
<script>$(document).ready(function(){$(".megamenu").megamenu();});</script>
<!-- dropdown -->
<script src="js/jquery.easydropdown.js"></script>
</head>
<body>
       <div class="header-top">
			<div class="wrap"> 
			 <div class="cssmenu">
				<ul>
<li class="active"><a class="account">用户信息</a></li> |
					<li><a href="checkout.html">结账</a></li> |
					<li><a href="login.html" class="loginbtn">登录</a></li>
					<li><a href="#" class="logoutbtn" style="display:none">注销</a></li> |
					<li><a href="register.html" class="signupbtn">注册</a></li>
				</ul>
			</div>
			<div class="clear"></div>
 		</div>
	</div>
	 <div class="header-bottom">
	    <div class="wrap">
			<div class="header-bottom-left">
				<div class="logo">
					<a href="index.html"><img src="images/logo.png" alt=""/></a>
				</div>
				<div class="menu">
	            <ul class="megamenu skyblue">
			<li class="active grid"><a href="index.html">Home</a></li>
			<li><a class="color4" href="category1.html">个人护理用品</a>
				</li>				
				<li><a class="color5" href="category2.html">食品饮料</a>
				</li>
				<li><a class="color6" href="category3.html">保健品</a></li>
				<li><a class="color7" href="category4.html">烟酒</a></li>
			</ul>
			</div>
		</div>
	   <div class="header-bottom-right">
         <div class="search">	  
				<input type="text" name="s" class="textbox" value="Search" onfocus="this.value = '';" onblur="if (this.value == '') {this.value = 'Search';}">
				<input type="submit" value="Subscribe" id="submit" name="submit">
				<div id="response"> </div>
		 </div>
	  <div class="tag-list">
		<ul class="icon1 sub-icon1 profile_img">
			<li><a class="active-icon c2" href="#"> </a>
				<ul class="sub-icon1 list basketinfo">
					<li><h3></h3></li>
				</ul>
			</li>
		</ul>
	    <ul class="last"><li><a href="#" class="cartnum">Cart(0)</a></li></ul>
	  </div>
    </div>
    </div>
     <div class="clear"></div>
     </div>
	</div>
         <div class="register_account">
           <div class="wrap">
    	     <h4 class="title carttitle"></h4>
  	     	<ul class="cartinfo">
  	     	</ul>
    	     <button id="pay">提交订单</button>
    	   </div>
    	</div>
    <div class="footer">
		<div class="footer-top">
			<div class="wrap">
			  <div class="section group example">
				<div class="col_1_of_2 span_1_of_2">
					<ul class="f-list">
					  <li><img src="images/2.png"><span class="f-text">我们不要运费，有钱任性！</span><div class="clear"></div></li>
					</ul>
				</div>
				<div class="col_1_of_2 span_1_of_2">
					<ul class="f-list">
					  <li><img src="images/3.png"><span class="f-text">客服电话-222-555-6666 </span><div class="clear"></div></li>
					</ul>
				</div>
				<div class="clear"></div>
		      </div>
			</div>
		</div>
		<div class="footer-bottom">
			<div class="wrap">
	             <div class="copy">
			        <p>Copyright &copy; 2014.思源小组 All rights reserved.</p>
		         </div>
				<div class="f-list2">
				 <ul>
					<li class="active"><a href="about.html">About Us</a></li> |
					<li><a href="delivery.html">Delivery & Returns</a></li> |
					<li><a href="delivery.html">Terms & Conditions</a></li> |
					<li><a href="contact.html">Contact Us</a></li> 
				 </ul>
			    </div>
			    <div class="clear"></div>
		      </div>
	     </div>
	</div>
<div style="display:none"></div>
<script type="text/javascript" src="js/master.js"></script>
<script src="http://202.120.40.175:40012/RMP/assets/js/jquery.cookie.js"></script>
<script src="http://202.120.40.175:40012/RMP/function/Attribute.js"></script>
<script src="http://202.120.40.175:40012/RMP/function/Resource.js"></script>
<script src="http://202.120.40.175:40012/RMP/function/ResourceCollection.js"></script>
<script type="text/javascript">
	var basket = [];
	var order;
	var user;
	$(window).load(function(){	
	  if ($.cookie("basket") != undefined)
	    basket = JSON.parse($.cookie("basket"));
	  if(basket.length == 0) {
	  	$('.carttitle').text('购物车是空的')
	  }
	  else {
	  	$('.carttitle').text('购物清单')
	  	$('.cartinfo').append($('<li>').addClass('cartitem').append($('<div>').addClass('cartcol1').text('名字')).
	  			append($('<div>').addClass('cartcol2').text('单价'))
	  			.append($('<div>').addClass('cartcol3').text('数量'))
	  			.append($('<div>').addClass('cartcol4').text('总价')))
	  	var total = 0;
	  	for (var i = 0; i < basket.length; i++) {
	  		$('.cartinfo').append($('<li>').addClass('cartitem').append($('<div>').addClass('cartcol1').text(basket[i].name)).
	  			append($('<div>').addClass('cartcol2').text(basket[i].price))
	  			.append($('<div>').addClass('cartcol3').text(basket[i].num))
	  			.append($('<div>').addClass('cartcol4').text(parseInt(basket[i].price) * 
	  				parseInt(basket[i].num))))
	  		total += parseInt(basket[i].price) * parseInt(basket[i].num)
	  	}
	  	$('.cartinfo').append('总价:￥' + total)
	  }
	})
	$('#pay').click(function(){
//post order here
		var content="";
		var number="";
		for (var i = 0; i < basket.length; i++) {
			var resourcecollection = ResourceCollection.createNew("Ua2b5599c83278/CPGM/good/");
			resourcecollection.addEqual("goodname",basket[i].name);
			resourcecollection.GET();
			var good = resourcecollection.getResultSet();
			content+=good[0].id+".";
			number+=basket[i].num+".";
			//alert(number);
		}
		//alert(number);
		var d=new Date();
		order = Resource.createNew("Ua2b5599c83278/CPGM/order/");
		order.addAttribute(Attribute.createNew("cont",content));
		order.addAttribute(Attribute.createNew("num",number));
		order.addAttribute(Attribute.createNew("stat",'待发货'));
		order.addAttribute(Attribute.createNew("odtime",d.toDateString()));
		//alert(d.toDateString());
		order.POST();
		if(order.msg!="<succeed></succeed>"){
			alert("订单创建失败");return;
		}
		user = Resource.createNew("Ua2b5599c83278/CPGM/user/"+$.cookie("user_uri"));
		user.GET();
		user.addSubresource(order);
		user.PUT();
		if(user.msg!="<succeed></succeed>"){
			alert("下单失败");return;
		}
		else{
			alert("下单成功");
		}
		//alert(user);
		$.removeCookie('basket');
	})
</script>
</body>
</html>